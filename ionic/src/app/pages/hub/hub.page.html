<ion-header>
  <ion-toolbar>
      <ion-buttons slot="start">
          <ion-back-button></ion-back-button>
        </ion-buttons>
        <div slot="end" href="javascript:void(0);" (click)="presentActionSheet()">
            <ion-icon size="large" name="more"></ion-icon>
        </div>
    <ion-title *ngIf="!loading && userHub">{{userHub.hub.name}}</ion-title>
    <ion-title *ngIf="loading">Hub</ion-title>
    <ion-progress-bar *ngIf="loading" type="indeterminate"></ion-progress-bar>
  </ion-toolbar>
</ion-header>

<ion-content>

    <app-hub-card *ngIf="!loading && userHub" 
    [hub]="userHub.hub" 
    [coords]="hubCoords"
    [starred]="userHub.starred"
    [isOwner]="userHub.isOwner">
  </app-hub-card>

  <ion-card *ngIf="!loading && userHub && hubCoords" style="height:30%" (click)="goToMap()">
      <ion-card-content style="height:100%">
          <app-google-map *ngIf="userHub" [coords]="hubCoords"></app-google-map>
      </ion-card-content>
    </ion-card>

<ion-list *ngIf="!loading && userHub">
  <ion-list-header>
    <ion-text>Present</ion-text>
  </ion-list-header>

  <div *ngFor="let userConnection of userHub.hub.usersConnection">
    <ion-item *ngIf="userConnection.isPresent" href="javascript:void(0);" (click)="goToPersonPage(userConnection.user.id, userConnection.user)">
      <ion-avatar slot="start">
        <!-- FIXME don't use this image or store a copy locally -->
        <img width="100%" *ngIf="!userConnection.user.image" src="https://ionicframework.com/docs/demos/api/avatar/avatar.svg">
        <ion-img width="100%" *ngIf="userConnection.user.image" src="{{userConnection.user.image}}"></ion-img>
      </ion-avatar>
      <ion-label>
        <h3 class="ion-float-left">
          <ion-text>{{userConnection.user.firstName}} {{userConnection.user.lastName}}</ion-text>
        </h3>
        <p *ngIf="userConnection.isOwner" class="ion-float-right">
          <ion-text>Admin</ion-text>
        </p>
      </ion-label>
    </ion-item>
  </div>

</ion-list>

<ion-list *ngIf="!loading && userHub">
  <ion-list-header>
    <ion-text>Away</ion-text>
  </ion-list-header>

  <div *ngFor="let userConnection of userHub.hub.usersConnection">
    <ion-item *ngIf="!userConnection.isPresent" href="javascript:void(0);" (click)="goToPersonPage(userConnection.user.id, userConnection.user)">
      <ion-avatar slot="start">
        <!-- FIXME don't use this image or store a copy locally -->
        <img width="100%" *ngIf="!userConnection.user.image" src="https://ionicframework.com/docs/demos/api/avatar/avatar.svg">
        <ion-img width="100%" *ngIf="userConnection.user.image" src="{{userConnection.user.image}}"></ion-img>
      </ion-avatar>
      <ion-label>
        <h3 class="ion-float-left">
          <ion-text>{{userConnection.user.firstName}} {{userConnection.user.lastName}}</ion-text>
        </h3>
        <p *ngIf="userConnection.isOwner" float-right>
          <ion-text>Admin</ion-text>
        </p>
      </ion-label>
    </ion-item>
  </div>

</ion-list>

  <div *ngIf="loading">

            <ion-list *ngIf="loading">
                <ion-list-header>
                  <ion-text>Present</ion-text>
                </ion-list-header>

                <ion-item>
                  <ion-avatar slot="start">
                    <ion-skeleton-text animated></ion-skeleton-text>
                  </ion-avatar>
                  <ion-label>
                    <h3>
                      <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
                    </h3>
                    <p>
                      <ion-skeleton-text animated style="width: 80%"></ion-skeleton-text>
                    </p>
                    <p>
                      <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
                    </p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-thumbnail slot="start">
                    <ion-skeleton-text animated></ion-skeleton-text>
                  </ion-thumbnail>
                  <ion-label>
                    <h3>
                      <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
                    </h3>
                    <p>
                      <ion-skeleton-text animated style="width: 80%"></ion-skeleton-text>
                    </p>
                    <p>
                      <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
                    </p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-skeleton-text animated style="width: 27px; height: 27px" slot="start"></ion-skeleton-text>
                  <ion-label>
                    <h3>
                      <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
                    </h3>
                    <p>
                      <ion-skeleton-text animated style="width: 80%"></ion-skeleton-text>
                    </p>
                    <p>
                      <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
                    </p>
                  </ion-label>
                </ion-item>

                <ion-list-header>
                    <ion-text>Away</ion-text>
                  </ion-list-header>
        
                <ion-item>
                    <ion-avatar slot="start">
                      <ion-skeleton-text animated></ion-skeleton-text>
                    </ion-avatar>
                    <ion-label>
                      <h3>
                        <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
                      </h3>
                      <p>
                        <ion-skeleton-text animated style="width: 80%"></ion-skeleton-text>
                      </p>
                      <p>
                        <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
                      </p>
                    </ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-thumbnail slot="start">
                      <ion-skeleton-text animated></ion-skeleton-text>
                    </ion-thumbnail>
                    <ion-label>
                      <h3>
                        <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
                      </h3>
                      <p>
                        <ion-skeleton-text animated style="width: 80%"></ion-skeleton-text>
                      </p>
                      <p>
                        <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
                      </p>
                    </ion-label>
                  </ion-item>
                  <ion-item>
                    <ion-skeleton-text animated style="width: 27px; height: 27px" slot="start"></ion-skeleton-text>
                    <ion-label>
                      <h3>
                        <ion-skeleton-text animated style="width: 50%"></ion-skeleton-text>
                      </h3>
                      <p>
                        <ion-skeleton-text animated style="width: 80%"></ion-skeleton-text>
                      </p>
                      <p>
                        <ion-skeleton-text animated style="width: 60%"></ion-skeleton-text>
                      </p>
                    </ion-label>
                  </ion-item>
              </ion-list>
  </div>

</ion-content>
